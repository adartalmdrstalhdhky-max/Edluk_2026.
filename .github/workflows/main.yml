name: Global Edluk Interactive Launch
on: [push]
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Setup Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: '3.19.0'
      
      - name: Create Global Interactive App
        run: |
          flutter create --project-name edluk_app --org com.essam.edluk .
          cat <<EOF > lib/main.dart
          import 'package:flutter/material.dart';

          void main() => runApp(EdlukApp());

          class EdlukApp extends StatelessWidget {
            @override
            Widget build(BuildContext context) {
              return MaterialApp(
                title: 'أدلك - Edluk',
                theme: ThemeData(
                  colorScheme: ColorScheme.fromSeed(seedColor: Colors.indigo),
                  useMaterial3: true,
                  fontFamily: 'Roboto',
                ),
                home: HomePage(),
                debugShowCheckedModeBanner: false,
              );
            }
          }

          class HomePage extends StatefulWidget {
            @override
            _HomePageState createState() => _HomePageState();
          }

          class _HomePageState extends State<HomePage> {
            @override
            Widget build(BuildContext context) {
              return Scaffold(
                appBar: AppBar(
                  title: Text('منارة الأجيال الرقمية', style: TextStyle(color: Colors.white, fontWeight: FontWeight.bold)),
                  backgroundColor: Colors.indigo,
                  centerTitle: true,
                  elevation: 10,
                ),
                body: Container(
                  decoration: BoxDecoration(
                    gradient: LinearGradient(
                      begin: Alignment.topCenter,
                      end: Alignment.bottomCenter,
                      colors: [Colors.indigo.shade50, Colors.white],
                    ),
                  ),
                  child: GridView.count(
                    padding: EdgeInsets.all(20),
                    crossAxisCount: 2,
                    mainAxisSpacing: 20,
                    crossAxisSpacing: 20,
                    children: [
                      _buildInteractiveCard(context, 'المعلم الذكي', Icons.psychology, Colors.orange, 'مرحباً عصام، أنا جاهز لتعليم الطلاب!'),
                      _buildInteractiveCard(context, 'الدروس التفاعلية', Icons.school, Colors.blue, 'تم فتح وحدة "الذكاء الاصطناعي" بنجاح.'),
                      _buildInteractiveCard(context, 'المكتبة الرقمية', Icons.menu_book, Colors.green, 'تحميل 17 ملف بيانات دراسية...'),
                      _buildInteractiveCard(context, 'تقارير الأداء', Icons.analytics, Colors.purple, 'تحليل ذكاء الطالب: ممتاز (98%)'),
                    ],
                  ),
                ),
                bottomNavigationBar: BottomAppBar(
                  child: Center(child: Text('نظام المدرسة الذكية - إصدار 2026', style: TextStyle(fontWeight: FontWeight.bold))),
                ),
                floatingActionButton: FloatingActionButton.extended(
                  onPressed: () => _showAiDialog(context),
                  label: Text('تحدث مع جيميني'),
                  icon: Icon(Icons.auto_awesome),
                  backgroundColor: Colors.indigo,
                  foregroundColor: Colors.white,
                ),
              );
            }

            Widget _buildInteractiveCard(BuildContext context, String title, IconData icon, Color color, String msg) {
              return Card(
                elevation: 8,
                shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(20)),
                child: InkWell(
                  onTap: () {
                    showModalBottomSheet(
                      context: context,
                      builder: (ctx) => Container(
                        padding: EdgeInsets.all(20),
                        height: 200,
                        child: Column(
                          children: [
                            Icon(icon, size: 50, color: color),
                            SizedBox(height: 15),
                            Text(title, style: TextStyle(fontSize: 20, fontWeight: FontWeight.bold)),
                            Divider(),
                            Text(msg, textAlign: TextAlign.center, style: TextStyle(fontSize: 16)),
                          ],
                        ),
                      ),
                    );
                  },
                  child: Column(
                    mainAxisAlignment: MainAxisAlignment.center,
                    children: [
                      Icon(icon, size: 60, color: color),
                      SizedBox(height: 12),
                      Text(title, style: TextStyle(fontWeight: FontWeight.bold, fontSize: 16)),
                    ],
                  ),
                ),
              );
            }

            void _showAiDialog(BuildContext context) {
              showDialog(
                context: context,
                builder: (ctx) => AlertDialog(
                  title: Text('ذكاء جيميني الاصطناعي'),
                  content: Text('أهلاً بكم في أول تجربة تعليمية ذكية في اليمن. كيف يمكنني مساعدتكم اليوم؟'),
                  actions: [
                    TextButton(onPressed: () => Navigator.pop(ctx), child: Text('بدء الحوار')),
                  ],
                ),
              );
            }
          }
          EOF

      - name: Build Historical APK
        run: |
          flutter pub get
          flutter build apk --release
          
      - name: Upload Artifact
        uses: actions/upload-artifact@v4
        with:
          name: edluk-interactive-apk
          path: build/app/outputs/flutter-apk/app-release.apk
          
