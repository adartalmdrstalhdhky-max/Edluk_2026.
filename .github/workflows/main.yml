name: Global Edluk Historical Build
on: [push]
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Setup Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: '3.19.0'
      
      - name: Create Global Project
        run: |
          # 1. إنشاء المشروع الأساسي النظيف
          flutter create --project-name edluk_app --org com.essam.edluk .
          
          # 2. توليد كود التطبيق الاحترافي (المعلم والذكاء الاصطناعي)
          cat <<EOF > lib/main.dart
          import 'package:flutter/material.dart';

          void main() => runApp(EdlukApp());

          class EdlukApp extends StatelessWidget {
            @override
            Widget build(BuildContext context) {
              return MaterialApp(
                title: 'أدلك - Edluk',
                theme: ThemeData(
                  colorScheme: ColorScheme.fromSeed(seedColor: Colors.indigo),
                  useMaterial3: true,
                ),
                home: HomePage(),
                debugShowCheckedModeBanner: false,
              );
            }
          }

          class HomePage extends StatelessWidget {
            @override
            Widget build(BuildContext context) {
              return Scaffold(
                appBar: AppBar(
                  title: Text('منارة الأجيال الرقمية', style: TextStyle(color: Colors.white)),
                  backgroundColor: Colors.indigo,
                  centerTitle: true,
                ),
                body: GridView.count(
                  padding: EdgeInsets.all(16),
                  crossAxisCount: 2,
                  mainAxisSpacing: 10,
                  crossAxisSpacing: 10,
                  children: [
                    _buildCard(context, 'المعلم الذكي', Icons.psychology, Colors.orange),
                    _buildCard(context, 'الدروس التفاعلية', Icons.school, Colors.blue),
                    _buildCard(context, 'المكتبة الرقمية', Icons.menu_book, Colors.green),
                    _buildCard(context, 'تقارير الأداء', Icons.analytics, Colors.purple),
                  ],
                ),
                floatingActionButton: FloatingActionButton.extended(
                  onPressed: () {},
                  label: Text('اسأل جيميني'),
                  icon: Icon(Icons.auto_awesome),
                ),
              );
            }

            Widget _buildCard(BuildContext context, String title, IconData icon, Color color) {
              return Card(
                elevation: 4,
                child: InkWell(
                  onTap: () => ScaffoldMessenger.of(context).showSnackBar(
                    SnackBar(content: Text('نظام \$title قيد التشغيل التجريبي')),
                  ),
                  child: Column(
                    mainAxisAlignment: MainAxisAlignment.center,
                    children: [
                      Icon(icon, size: 50, color: color),
                      SizedBox(height: 10),
                      Text(title, style: TextStyle(fontWeight: FontWeight.bold)),
                    ],
                  ),
                ),
              );
            }
          }
          EOF

      - name: Build Historical APK
        run: |
          # بناء النسخة بدون الأمر المسبب للخطأ
          flutter pub get
          flutter build apk --release
          
      - name: Upload Artifact
        uses: actions/upload-artifact@v4
        with:
          name: edluk-historical-apk
          path: build/app/outputs/flutter-apk/app-release.apk
          
