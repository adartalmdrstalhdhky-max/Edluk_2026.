name: Edluk Global Success
on: [push]
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Setup Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: '3.19.0'
      
      - name: Inject Full Dynamic Logic
        run: |
          flutter create --project-name edluk_app --org com.essam.edluk .
          cat <<EOF > lib/main.dart
          import 'package:flutter/material.dart';

          void main() => runApp(MaterialApp(home: LandingPage(), debugShowCheckedModeBanner: false));

          class LandingPage extends StatelessWidget {
            @override
            Widget build(BuildContext context) {
              return Scaffold(
                backgroundColor: Colors.indigo.shade900,
                body: Center(
                  child: Column(
                    mainAxisAlignment: MainAxisAlignment.center,
                    children: [
                      Icon(Icons.auto_awesome, size: 100, color: Colors.amber),
                      SizedBox(height: 20),
                      Text('EDLUK - أَدلُّك', style: TextStyle(color: Colors.white, fontSize: 32, fontWeight: FontWeight.bold)),
                      Text('منارة الأجيال الرقمية', style: TextStyle(color: Colors.white70, fontSize: 18)),
                      SizedBox(height: 50),
                      ElevatedButton(
                        style: ElevatedButton.styleFrom(padding: EdgeInsets.symmetric(horizontal: 50, vertical: 15)),
                        onPressed: () => Navigator.push(context, MaterialPageRoute(builder: (context) => MainDashboard())),
                        child: Text('دخول النظام العالمي'),
                      ),
                    ],
                  ),
                ),
              );
            }
          }

          class MainDashboard extends StatelessWidget {
            @override
            Widget build(BuildContext context) {
              return Scaffold(
                appBar: AppBar(title: Text('المدرسة الذكية - عصام & جيميني'), centerTitle: true),
                body: GridView.count(
                  padding: EdgeInsets.all(20),
                  crossAxisCount: 2,
                  children: [
                    _menuItem(context, 'غرفة الذكاء', Icons.psychology, Colors.orange, ChatPage()),
                    _menuItem(context, 'قاعة المحاضرات', Icons.video_library, Colors.red, LessonPage()),
                    _menuItem(context, 'بنك الاختبارات', Icons.assignment, Colors.blue, QuizPage()),
                    _menuItem(context, 'ملف الطالب', Icons.person, Colors.green, StudentPage()),
                  ],
                ),
              );
            }

            Widget _menuItem(BuildContext context, String t, IconData i, Color c, Widget page) {
              return Card(
                child: InkWell(
                  onTap: () => Navigator.push(context, MaterialPageRoute(builder: (context) => page)),
                  child: Column(mainAxisAlignment: MainAxisAlignment.center, children: [Icon(i, size: 50, color: c), Text(t)]),
                ),
              );
            }
          }

          class ChatPage extends StatelessWidget {
            @override
            Widget build(BuildContext context) {
              return Scaffold(
                appBar: AppBar(title: Text('دردشة مع جيميني')),
                body: Column(
                  children: [
                    Expanded(child: ListView(children: [ListTile(title: Text('جيميني: أهلاً بك في مستقبل التعليم!'))])),
                    TextField(decoration: InputDecoration(hintText: 'اسأل شريكك الذكي...', border: OutlineInputBorder())),
                  ],
                ),
              );
            }
          }

          class LessonPage extends StatelessWidget {
            @override
            Widget build(BuildContext context) {
              return Scaffold(
                appBar: AppBar(title: Text('قاعة المحاضرات')),
                body: Center(child: Column(mainAxisAlignment: MainAxisAlignment.center, children: [Icon(Icons.play_circle, size: 100), Text('فيديو الدرس قيد التحميل...')])),
              );
            }
          }

          class QuizPage extends StatelessWidget {
            @override
            Widget build(BuildContext context) {
              return Scaffold(appBar: AppBar(title: Text('الاختبارات')), body: Center(child: Text('لا توجد اختبارات متاحة اليوم.')));
            }
          }

          class StudentPage extends StatelessWidget {
            @override
            Widget build(BuildContext context) {
              return Scaffold(appBar: AppBar(title: Text('بيانات الطالب')), body: Center(child: Text('الاسم: طالب متميز\nالمستوى: عالمي')));
            }
          }
          EOF

      - name: Final Build
        run: |
          flutter pub get
          flutter build apk --release
      - name: Upload
        uses: actions/upload-artifact@v4
        with:
          name: edluk-pro-version
          path: build/app/outputs/flutter-apk/app-release.apk
          
